"use strict";
module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){var r=n(1),o=n(51).default,i=n(56),a=n(72),s=r.createServer(function(e,t){return a.info("Starting SSO Dashboard Extension - Version:","2.4.0"),o(e,t)});e.exports=function(e,t,n){t.x_wt&&t.x_wt.ectx&&t.x_wt.ectx.PUBLIC_WT_URL||!1||i.setValue("PUBLIC_WT_URL",r.urlHelpers.getWebtaskUrl(t)),s(e,t,n)}},function(e,t,n){const r=n(2),o=n(5),i=n(7),a=n(43);e.exports.createServer=r.createServer,e.exports.urlHelpers=o,e.exports.middlewares=i,e.exports.routes=a},function(e,t,n){const r=n(3),o=n(4);e.exports.createServer=function(e){const t=r.createServer(e);var n=null;return o.fromExpress(function(e,r){return n||(n=t(e.webtaskContext)),n(e,r)})}},function(e,t){e.exports=require("auth0-extension-tools@1.3.2")},function(e,t){e.exports=require("webtask-tools")},function(e,t,n){const r=n(6),o=3,i=2,a=1,s=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports.getBasePath=function(e){return t=e.originalUrl||"",n=e.path,(o=(o=r.parse(t).pathname||"").replace(n,"").replace(/^\/|\/$/g,"")).startsWith("/")||(o="/"+o),o.endsWith("/")||(o+="/"),o;var t,n,o},e.exports.getBaseUrl=function(e,t){var n=t;const o=r.parse(e.originalUrl||"").pathname||"";return r.format({protocol:n||"https",host:e.headers.host,pathname:o.replace(e.path,"").replace(/\/$/g,"")})},e.exports.getWebtaskUrl=function(e){const t=function(e){if(!e.container)return null;const t=e.container.replace(s,"\\$&"),n=e.jtn?e.jtn.replace(s,"\\$&"):"";if(e.url_format===a)return new RegExp("^/api/run/"+t+"/(?:"+n+"/?)?");if(e.url_format===i)return new RegExp("^/"+t+"/(?:"+n+"/?)?");if(e.url_format===o)return new RegExp("^/(?:"+n+"/?)?");throw new Error("Unsupported webtask URL format.")}(e.x_wt),n=e.url,u=e.url.replace(t,"/"),c=r.parse(u||"").pathname,l=e.x_wt&&e.x_wt.ectx&&e.x_wt.ectx.ISOLATED_DOMAIN||!1,d=r.parse(n||"").pathname||"";var p;if(l){p=r.format({protocol:"https",host:e.headers.host,pathname:d.replace(c,"").replace(/\/$/g,"")});const t=".it.auth0.com/api/run/"+e.x_wt.container+"/",n=function(e,t){if(!e)return null;const n=e.indexOf("sandbox8")>=0?"8":"";return"https://"+t+"."+(e.split(".it.auth0.com")[0].split("-")[1]||"us")+n+".webtask.io/"}(p,e.x_wt.container);p.indexOf(t)>=0&&(p=p.replace("https://"+e.headers.host+"/api/run/"+e.x_wt.container+"/",n))}else p=d;return p}},function(e,t){e.exports=require("url")},function(e,t,n){e.exports.authenticateAdmins=n(8),e.exports.authenticateUsers=n(16),e.exports.requireAuthentication=n(38),e.exports.errorHandler=n(39),e.exports.managementApiClient=n(40),e.exports.validateHookToken=n(41),e.exports.webtaskConfig=n(42)},function(e,t,n){const r=n(9),o=n(12),i=n(3),a=n(13);e.exports=function(e){if(!e||"object"!=typeof e)throw new i.ArgumentError("Must provide the options");if(null===e.secret||void 0===e.secret)throw new i.ArgumentError("Must provide a valid secret");if("string"!=typeof e.secret||0===e.secret.length)throw new i.ArgumentError("The provided secret is invalid: "+e.secret);if(null===e.audience||void 0===e.audience)throw new i.ArgumentError("Must provide a valid secret");if("string"!=typeof e.audience||0===e.audience.length)throw new i.ArgumentError("The provided audience is invalid: "+e.audience);if(null===e.baseUrl||void 0===e.baseUrl)throw new i.ArgumentError("Must provide a valid base URL");if("string"!=typeof e.baseUrl||0===e.baseUrl.length)throw new i.ArgumentError("The provided base URL is invalid: "+e.baseUrl);const t=o({audience:e.audience,issuer:e.baseUrl,secret:e.secret,algorithms:["HS256"],credentialsRequired:e.credentialsRequired||!0});return function(n,r,o){t(n,r,function(t){return t?o(t):e.onLoginSuccess?e.onLoginSuccess(n,r,o):o()})}},e.exports.optional=function(t){const n=e.exports(t);return a(function(e){if(e&&e.headers&&e.headers.authorization&&0===e.headers.authorization.indexOf("Bearer "))try{const n=r(e.headers.authorization.split(" ")[1]);return n&&n.iss===t.baseUrl}catch(e){return!1}return!1},n)}},function(e,t,n){"use strict";var r=n(10);function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new o("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(r(e.split(".")[n]))}catch(e){throw new o("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=o},function(e,t,n){var r=n(11);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}(t)}catch(e){return r(t)}}},function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,i,a=0,s=0,u="";i=t.charAt(s++);~i&&(o=a%4?64*o+i:i,a++%4)?u+=String.fromCharCode(255&o>>(-2*a&6)):0)i=n.indexOf(i);return u}},function(e,t){e.exports=require("express-jwt@3.1.0")},function(e,t,n){"use strict";var r=n(14);e.exports=function(e,t,n){return function(o,i,a){var s=r(a);return!0===e||"function"==typeof e&&e(o,i,s)?t(o,i,s):n?n(o,i,s):s()}}},function(e,t,n){var r=n(15);function o(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function i(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}e.exports=r(o),e.exports.strict=r(i),o.proto=o(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return o(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})})},function(e,t){e.exports=function e(t,n){if(t&&n)return e(t)(n);if("function"!=typeof t)throw new TypeError("need wrapper function");Object.keys(t).forEach(function(e){r[e]=t[e]});return r;function r(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];var r=t.apply(this,e),o=e[e.length-1];return"function"==typeof r&&r!==o&&Object.keys(o).forEach(function(e){r[e]=o[e]}),r}}},function(e,t,n){const r=n(9),o=n(12),i=n(17),a=n(3),s=n(13),u=n(3).UnauthorizedError;e.exports=function(e){if(!e||"object"!=typeof e)throw new a.ArgumentError("Must provide the options");if(null===e.domain||void 0===e.domain)throw new a.ArgumentError("Must provide a valid domain");if("string"!=typeof e.domain||0===e.domain.length)throw new a.ArgumentError("The provided domain is invalid: "+e.domain);if(null===e.audience||void 0===e.audience)throw new a.ArgumentError("Must provide a valid audience");if("string"!=typeof e.audience||0===e.audience.length)throw new a.ArgumentError("The provided audience is invalid: "+e.audience);const t=o({secret:i.expressJwtSecret({cache:!0,rateLimit:!0,jwksRequestsPerMinute:5,jwksUri:"https://"+e.domain+"/.well-known/jwks.json",handleSigningKeyError:function(e,t){return e instanceof i.SigningKeyNotFoundError?t(new u("A token was provided with an invalid kid")):t(e)}}),audience:e.audience,issuer:"https://"+e.domain+"/",algorithms:["RS256"],credentialsRequired:e&&e.credentialsRequired||!0});return function(n,r,o){t(n,r,function(t){return t?o(t):e.onLoginSuccess?e.onLoginSuccess(n,r,o):o()})}},e.exports.optional=function(t){const n=e.exports(t);return s(function(e){if(e&&e.headers&&e.headers.authorization&&0===e.headers.authorization.indexOf("Bearer "))try{const n=r(e.headers.authorization.split(" ")[1]);return n&&n.iss==="https://"+t.domain+"/"}catch(e){return!1}return!1},n)}},function(e,t,n){"use strict";var r=n(18),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(34)),i=n(35),a=n(36),s=n(37);e.exports=function(e){return new r.JwksClient(e)},e.exports.ArgumentError=o.ArgumentError,e.exports.JwksError=o.JwksError,e.exports.JwksRateLimitError=o.JwksRateLimitError,e.exports.SigningKeyNotFoundError=o.SigningKeyNotFoundError,e.exports.expressJwtSecret=a.expressJwtSecret,e.exports.hapiJwt2Key=i.hapiJwt2Key,e.exports.koaJwtSecret=s.koaJwtSecret},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JwksClient=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=d(n(19)),a=d(n(20)),s=(d(n(21)),d(n(22))),u=d(n(23)),c=n(24),l=n(25);function d(e){return e&&e.__esModule?e:{default:e}}t.JwksClient=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.getSigningKey=function(e,t){n.logger("Fetching signing key for '"+e+"'"),n.getSigningKeys(function(r,o){if(r)return t(r);var i=o.find(function(t){return t.kid===e});return i?t(null,i):(n.logger("Unable to find a signing key that matches '"+e+"'"),t(new u.default("Unable to find a signing key that matches '"+e+"'")))})},this.options=r({rateLimit:!1,cache:!1,strictSsl:!0},t),this.logger=(0,i.default)("jwks"),this.options.rateLimit&&(this.getSigningKey=(0,l.rateLimitSigningKey)(this,t)),this.options.cache&&(this.getSigningKey=(0,l.cacheSigningKey)(this,t))}return o(e,[{key:"getKeys",value:function(e){var t=this;this.logger("Fetching keys from '"+this.options.jwksUri+"'"),(0,a.default)({json:!0,uri:this.options.jwksUri,strictSSL:this.options.strictSsl},function(n,r){return n||r.statusCode<200||r.statusCode>=300?(t.logger("Failure:",r&&r.body||n),e(r?new s.default(r.body&&(r.body.message||r.body)||r.statusMessage||"Http Error "+r.statusCode):n)):(t.logger("Keys:",r.body.keys),e(null,r.body.keys))})}},{key:"getSigningKeys",value:function(e){var t=this;this.getKeys(function(n,r){if(n)return e(n);if(!r||!r.length)return e(new s.default("The JWKS endpoint did not contain any keys"));var o=r.filter(function(e){return"sig"===e.use&&"RSA"===e.kty&&e.kid&&(e.x5c&&e.x5c.length||e.n&&e.e)}).map(function(e){return e.x5c&&e.x5c.length?{kid:e.kid,nbf:e.nbf,publicKey:(0,c.certToPEM)(e.x5c[0])}:{kid:e.kid,nbf:e.nbf,rsaPublicKey:(0,c.rsaPublicKeyToPEM)(e.n,e.e)}});return o.length?(t.logger("Signing Keys:",o),e(null,o)):e(new s.default("The JWKS endpoint did not contain any signing keys"))})}}]),e}()},function(e,t){e.exports=require("debug@2.2.0")},function(e,t){e.exports=require("request@2.56.0")},function(e,t,n){"use strict";function r(e){Error.call(this,e),Error.captureStackTrace(this,this.constructor),this.name="ArgumentError",this.message=e}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,e.exports=r},function(e,t,n){"use strict";function r(e){Error.call(this,e),Error.captureStackTrace(this,this.constructor),this.name="JwksError",this.message=e}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,e.exports=r},function(e,t,n){"use strict";function r(e){Error.call(this,e),Error.captureStackTrace(this,this.constructor),this.name="SigningKeyNotFoundError",this.message=e}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,e.exports=r},function(e,t,n){"use strict";function r(e){var t=e[0];return t<"0"||t>"7"?"00"+e:e}function o(e){var t=e.toString(16);return t.length%2?"0"+t:t}function i(e){if(e<=127)return o(e);var t=o(e);return o(128+t.length/2)+t}Object.defineProperty(t,"__esModule",{value:!0}),t.certToPEM=function(e){return e="-----BEGIN CERTIFICATE-----\n"+(e=e.match(/.{1,64}/g).join("\n"))+"\n-----END CERTIFICATE-----\n"},t.rsaPublicKeyToPEM=function(e,t){var n=new Buffer(e,"base64"),o=new Buffer(t,"base64"),a=r(n.toString("hex")),s=r(o.toString("hex")),u=a.length/2,c=s.length/2,l=i(u),d=i(c),p="30"+i(u+c+l.length/2+d.length/2+2)+"02"+l+a+"02"+d+s,f=new Buffer(p,"hex").toString("base64"),h="-----BEGIN RSA PUBLIC KEY-----\n";return h+=""+f.match(/.{1,64}/g).join("\n"),h+="\n-----END RSA PUBLIC KEY-----\n"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rateLimitSigningKey=t.cacheSigningKey=void 0;var r=i(n(26)),o=i(n(29));function i(e){return e&&e.__esModule?e:{default:e}}t.cacheSigningKey=r.default,t.rateLimitSigningKey=o.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:options,n=t.cacheMaxEntries,a=void 0===n?5:n,s=t.cacheMaxAge,u=void 0===s?(0,r.default)("10h"):s,c=(0,o.default)("jwks"),l=e.getSigningKey;return c("Configured caching of singing keys. Max: "+a+" / Age: "+u),(0,i.default)({load:function(e,t){l(e,function(n,r){return n?t(n):(c("Caching signing key for '"+e+"':",r),t(null,r))})},hash:function(e){return e},maxAge:u,max:a})};var r=a(n(27)),o=a(n(19)),i=a(n(28));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=require("ms@0.7.1")},function(e,t){e.exports=require("lru-memoizer@1.10.0")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:options).jwksRequestsPerMinute,n=void 0===t?10:t,a=(0,r.default)("jwks"),s=e.getSigningKey,u=new o.RateLimiter(n,"minute",!0);return a("Configured rate limiting to JWKS endpoint at "+n+"/minute"),function(e,t){u.removeTokens(1,function(n,r){return n?t(n):(a("Requests to the JWKS endpoint available for the next minute:",r),r<0?(a("Too many requests to the JWKS endpoint"),t(new i.default("Too many requests to the JWKS endpoint"))):s(e,t))})}};var r=a(n(19)),o=n(30),i=a(n(33));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){t.RateLimiter=n(31),t.TokenBucket=n(32)},function(e,t,n){var r=n(32),o=function(e,t,n){this.tokenBucket=new r(e,e,t,null),this.tokenBucket.content=e,this.curIntervalStart=+new Date,this.tokensThisInterval=0,this.fireImmediately=n};o.prototype={tokenBucket:null,curIntervalStart:0,tokensThisInterval:0,fireImmediately:!1,removeTokens:function(e,t){if(e>this.tokenBucket.bucketSize)return process.nextTick(t.bind(null,"Requested tokens "+e+" exceeds maximum tokens per interval "+this.tokenBucket.bucketSize,null)),!1;var n=this,r=Date.now();if(r-this.curIntervalStart>=this.tokenBucket.interval&&(this.curIntervalStart=r,this.tokensThisInterval=0),e>this.tokenBucket.tokensPerInterval-this.tokensThisInterval){if(this.fireImmediately)process.nextTick(t.bind(null,null,-1));else{var o=Math.ceil(this.curIntervalStart+this.tokenBucket.interval-r);setTimeout(function(){n.tokenBucket.removeTokens(e,i)},o)}return!1}return this.tokenBucket.removeTokens(e,i);function i(r,o){if(r)return t(r,null);n.tokensThisInterval+=e,t(null,o)}},tryRemoveTokens:function(e){if(e>this.tokenBucket.bucketSize)return!1;var t=Date.now();return t-this.curIntervalStart>=this.tokenBucket.interval&&(this.curIntervalStart=t,this.tokensThisInterval=0),!(e>this.tokenBucket.tokensPerInterval-this.tokensThisInterval)&&this.tokenBucket.tryRemoveTokens(e)},getTokensRemaining:function(){return this.tokenBucket.drip(),this.tokenBucket.content}},e.exports=o},function(e,t){var n=function(e,t,n,r){if(this.bucketSize=e,this.tokensPerInterval=t,"string"==typeof n)switch(n){case"sec":case"second":this.interval=1e3;break;case"min":case"minute":this.interval=6e4;break;case"hr":case"hour":this.interval=36e5;break;case"day":this.interval=864e5}else this.interval=n;this.parentBucket=r,this.content=0,this.lastDrip=+new Date};n.prototype={bucketSize:1,tokensPerInterval:1,interval:1e3,parentBucket:null,content:0,lastDrip:0,removeTokens:function(e,t){var n=this;return this.bucketSize?e>this.bucketSize?(process.nextTick(t.bind(null,"Requested tokens "+e+" exceeds bucket size "+this.bucketSize,null)),!1):(this.drip(),e>this.content?r():this.parentBucket?this.parentBucket.removeTokens(e,function(o,i){return o?t(o,null):e>n.content?r():(n.content-=e,void t(null,Math.min(i,n.content)))}):(this.content-=e,process.nextTick(t.bind(null,null,this.content)),!0)):(process.nextTick(t.bind(null,null,e,Number.POSITIVE_INFINITY)),!0);function r(){var r=Math.ceil((e-n.content)*(n.interval/n.tokensPerInterval));return setTimeout(function(){n.removeTokens(e,t)},r),!1}},tryRemoveTokens:function(e){return!this.bucketSize||!(e>this.bucketSize)&&(this.drip(),!(e>this.content)&&(!(this.parentBucket&&!this.parent.tryRemoveTokens(e))&&(this.content-=e,!0)))},drip:function(){if(this.tokensPerInterval){var e=+new Date,t=Math.max(e-this.lastDrip,0);this.lastDrip=e;var n=t*(this.tokensPerInterval/this.interval);this.content=Math.min(this.content+n,this.bucketSize)}else this.content=this.bucketSize}},e.exports=n},function(e,t,n){"use strict";function r(e){Error.call(this,e),Error.captureStackTrace(this,this.constructor),this.name="JwksRateLimitError",this.message=e}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SigningKeyNotFoundError=t.JwksRateLimitError=t.JwksError=t.ArgumentError=void 0;var r=s(n(21)),o=s(n(22)),i=s(n(33)),a=s(n(23));function s(e){return e&&e.__esModule?e:{default:e}}t.ArgumentError=r.default,t.JwksError=o.default,t.JwksRateLimitError=i.default,t.SigningKeyNotFoundError=a.default},function(e,t,n){"use strict";var r=n(34),o=n(18),i=function(e,t){return e&&"SigningKeyNotFoundError"===e.name?t(null,null,null):e?t(e,null,null):void 0};e.exports.hapiJwt2Key=function(e){if(null===e||void 0===e)throw new r.ArgumentError("An options object must be provided when initializing expressJwtSecret");var t=new o.JwksClient(e),n=e.handleSigningKeyError||i;return function(e,r){return e&&e.header?"RS256"!==e.header.alg?r(null,null,null):void t.getSigningKey(e.header.kid,function(e,t){return e?n(e,function(e){return r(e,null,null)}):r(null,t.publicKey||t.rsaPublicKey,t)}):r(null,null,null)}}},function(e,t,n){"use strict";var r=n(34),o=n(18),i=function(e,t){return e&&"SigningKeyNotFoundError"===e.name?t(null):e?t(e):void 0};e.exports.expressJwtSecret=function(e){if(null===e||void 0===e)throw new r.ArgumentError("An options object must be provided when initializing expressJwtSecret");var t=new o.JwksClient(e),n=e.handleSigningKeyError||i;return function(e,r,o,i){if(!r||"RS256"!==r.alg)return i(null,null);t.getSigningKey(r.kid,function(e,t){return e?n(e,function(e){return i(e,null)}):i(null,t.publicKey||t.rsaPublicKey)})}}},function(e,t,n){"use strict";var r=n(34),o=n(18);e.exports.koaJwtSecret=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.jwksUri)throw new r.ArgumentError("No JWKS URI provided");var t=new o.JwksClient(e);return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.alg,o=n.kid;return new Promise(function(n,i){if("RS256"!==r)return i(new Error("Missing / invalid token algorithm"));t.getSigningKey(o,function(t,r){if(t)return e.handleSigningKeyError?e.handleSigningKeyError(t).then(i):i(t);n(r.publicKey||r.rsaPublicKey)})})}}},function(e,t,n){const r=n(3).UnauthorizedError;e.exports=function(e,t,n){return e.user?n():n(new r("Authentication required for this endpoint."))}},function(e,t,n){e.exports=function(e){return function(t,n,r,o){return e&&e(t),t&&t.status?(r.status(t.status),r.json({error:t.code||t.name,message:t.message||t.name})):(r.status(t.status||500),r.json({error:"InternalServerError",message:t.message||t.name}))}}},function(e,t,n){const r=n(3);e.exports=function(e){return function(t,n,o){const i=t,a=t.user&&t.user.access_token&&t.user.access_token.length?{domain:e.domain,accessToken:t.user.access_token}:e;r.managementApi.getClient(a).then(function(e){return i.auth0=e,o(),null}).catch(function(e){o(e)})}}},function(e,t,n){const r=n(3);e.exports=function(e,t,n){if(null===e||void 0===e)throw new r.ArgumentError("Must provide the domain");if("string"!=typeof e||0===e.length)throw new r.ArgumentError("The provided domain is invalid: "+e);if(null===t||void 0===t)throw new r.ArgumentError("Must provide the webtaskUrl");if("string"!=typeof t||0===t.length)throw new r.ArgumentError("The provided webtaskUrl is invalid: "+t);if(null===n||void 0===n)throw new r.ArgumentError("Must provide the extensionSecret");if("string"!=typeof n||0===n.length)throw new r.ArgumentError("The provided extensionSecret is invalid: "+n);return function(o){if(null===o||void 0===o)throw new r.ArgumentError("Must provide the hookPath");if("string"!=typeof o||0===o.length)throw new r.ArgumentError("The provided hookPath is invalid: "+o);return function(i,a,s){if(i.headers.authorization&&"Bearer"===i.headers.authorization.split(" ")[0]){const a=i.headers.authorization.split(" ")[1];try{if(r.validateHookToken(e,t,o,n,a))return s()}catch(e){return s(e)}}return s(new r.HookTokenError("Hook token missing for the call to: "+o))}}}},function(e,t,n){const r=n(3);e.exports=function(e){return function(t,n,o){return t.webtaskContext&&e.setProvider(r.configProvider.fromWebtaskContext(t.webtaskContext)),o()}}},function(e,t,n){e.exports.dashboardAdmins=n(44)},function(e,t,n){const r=n(45),o=n(46),i=n(47),a=n(50),s=n(3),u=n(5);e.exports=function(e){if(!e||"object"!=typeof e)throw new s.ArgumentError("Must provide the options");if(null===e.secret||void 0===e.secret)throw new s.ArgumentError("Must provide a valid secret");if("string"!=typeof e.secret||0===e.secret.length)throw new s.ArgumentError("The provided secret is invalid: "+e.secret);if(null===e.audience||void 0===e.audience)throw new s.ArgumentError("Must provide a valid audience");if("string"!=typeof e.audience||0===e.audience.length)throw new s.ArgumentError("The provided audience is invalid: "+e.audience);if(null===e.rta||void 0===e.rta)throw new s.ArgumentError("Must provide a valid rta");if("string"!=typeof e.rta||0===e.rta.length)throw new s.ArgumentError("The provided rta is invalid: "+e.rta);if(null===e.domain||void 0===e.domain)throw new s.ArgumentError("Must provide a valid domain");if("string"!=typeof e.domain||0===e.domain.length)throw new s.ArgumentError("The provided domain is invalid: "+e.domain);if(null===e.baseUrl||void 0===e.baseUrl)throw new s.ArgumentError("Must provide a valid base URL");if("string"!=typeof e.baseUrl||0===e.baseUrl.length)throw new s.ArgumentError("The provided base URL is invalid: "+e.baseUrl);if(null===e.clientName||void 0===e.clientName)throw new s.ArgumentError("Must provide a valid client name");if("string"!=typeof e.clientName||0===e.clientName.length)throw new s.ArgumentError("The provided client name is invalid: "+e.clientName);if(void 0!==e.storageType&&"sessionStorage"!==e.storageType&&"localStorage"!==e.storageType)throw new s.ArgumentError('The storageType must be either "sessionStorage" or "localStorage". Incorrect storageType: '+e.storageType);const t=e.stateKey||"state",n=e.nonceKey||"nonce",c=e.urlPrefix||"",l=e.storageType||"sessionStorage",d=e.storageKey||e.sessionStorageKey||"apiToken",p=new s.SessionManager(e.rta,e.domain,e.baseUrl),f=r.Router();return f.get(c+"/login",function(r,i){const a=u.getBasePath(r),s=o.randomBytes(16).toString("hex"),l=o.randomBytes(16).toString("hex"),d={httpOnly:!0,path:a};i.cookie(t,s,Object.assign({},d,{sameSite:"None",secure:!0})),i.cookie(n,l,Object.assign({},d,{sameSite:"None",secure:!0})),i.cookie(t+"_compat",s,d),i.cookie(n+"_compat",l,d);const f=p.createAuthorizeUrl({redirectUri:u.getBaseUrl(r)+c+"/login/callback",scopes:e.scopes,expiration:e.expiration,nonce:l,state:s});i.redirect(f)}),f.post(c+"/login/callback",i(),function(r,o,i){var c;try{c=a.decode(r.body.id_token)}catch(e){c=null}if(!c)return i(new s.ValidationError("Login failed. Invalid token."));if(r.cookies&&r.cookies[n]&&r.cookies[n]!==c.nonce||r.cookies&&r.cookies[n+"_compat"]&&r.cookies[n+"_compat"]!==c.nonce)return i(new s.ValidationError("Login failed. Nonce mismatch."));if(r.cookies&&r.cookies[t]&&r.cookies[t]!==r.body.state||r.cookies&&r.cookies[t+"_compat"]&&r.cookies[t+"_compat"]!==r.body.state)return i(new s.ValidationError("Login failed. State mismatch."));const f=u.getBasePath(r);return p.create(r.body.id_token,r.body.access_token,{secret:e.secret,issuer:e.baseUrl,audience:e.audience,noAccessToken:e.noAccessToken}).then(function(e){o.clearCookie(t,{path:f}),o.clearCookie(n,{path:f}),o.clearCookie(t+"_compat",{path:f}),o.clearCookie(n+"_compat",{path:f}),o.header("Content-Type","text/html"),o.status(200).send('<html><head><script type="text/javascript">'+l+'.setItem("'+d+'", "'+e+'");window.location.href = "'+u.getBaseUrl(r)+'";<\/script></head></html>')}).catch(function(e){i(e)})}),f.get(c+"/logout",function(r,o){const i=u.getBasePath(r),a=encodeURIComponent(u.getBaseUrl(r));o.clearCookie(t,{path:i}),o.clearCookie(n,{path:i}),o.clearCookie(t+"_compat",{path:i}),o.clearCookie(n+"_compat",{path:i}),o.header("Content-Type","text/html"),o.status(200).send('<html><head><script type="text/javascript">'+l+'.removeItem("'+d+'");window.location.href = "https://'+e.rta+"/v2/logout/?returnTo="+a+"&client_id="+a+'";<\/script></head></html>')}),f.get("/.well-known/oauth2-client-configuration",function(t,n){n.header("Content-Type","application/json"),n.status(200).send({redirect_uris:[u.getBaseUrl(t)+c+"/login/callback"],client_name:e.clientName,post_logout_redirect_uris:[u.getBaseUrl(t)]})}),f}},function(e,t){e.exports=require("express@4.12.4")},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";var r=n(48),o=n(49);function i(e){if("string"==typeof e&&"j:"===e.substr(0,2))try{return JSON.parse(e.slice(2))}catch(e){return}}function a(e){for(var t,n,r=Object.keys(e),o=0;o<r.length;o++)(n=i(e[t=r[o]]))&&(e[t]=n);return e}function s(e,t){if("string"==typeof e){if("s:"!==e.substr(0,2))return e;for(var n=!t||Array.isArray(t)?t||[]:[t],r=0;r<n.length;r++){var i=o.unsign(e.slice(2),n[r]);if(!1!==i)return i}return!1}}function u(e,t){for(var n,r,o,i=Object.keys(e),a=Object.create(null),u=0;u<i.length;u++)(o=e[r=i[u]])!==(n=s(o,t))&&(a[r]=n,delete e[r]);return a}e.exports=function(e,t){var n=!e||Array.isArray(e)?e||[]:[e];return function(e,o,i){if(e.cookies)return i();var s=e.headers.cookie;if(e.secret=n[0],e.cookies=Object.create(null),e.signedCookies=Object.create(null),!s)return i();e.cookies=r.parse(s,t),0!==n.length&&(e.signedCookies=u(e.cookies,n),e.signedCookies=a(e.signedCookies)),e.cookies=a(e.cookies),i()}},e.exports.JSONCookie=i,e.exports.JSONCookies=a,e.exports.signedCookie=s,e.exports.signedCookies=u},function(e,t,n){"use strict";t.parse=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var n={},o=t||{},a=e.split(i),u=o.decode||r,c=0;c<a.length;c++){var l=a[c],d=l.indexOf("=");if(!(d<0)){var p=l.substr(0,d).trim(),f=l.substr(++d,l.length).trim();'"'==f[0]&&(f=f.slice(1,-1)),void 0==n[p]&&(n[p]=s(f,u))}}return n},t.serialize=function(e,t,n){var r=n||{},i=r.encode||o;if("function"!=typeof i)throw new TypeError("option encode is invalid");if(!a.test(e))throw new TypeError("argument name is invalid");var s=i(t);if(s&&!a.test(s))throw new TypeError("argument val is invalid");var u=e+"="+s;if(null!=r.maxAge){var c=r.maxAge-0;if(isNaN(c))throw new Error("maxAge should be a Number");u+="; Max-Age="+Math.floor(c)}if(r.domain){if(!a.test(r.domain))throw new TypeError("option domain is invalid");u+="; Domain="+r.domain}if(r.path){if(!a.test(r.path))throw new TypeError("option path is invalid");u+="; Path="+r.path}if(r.expires){if("function"!=typeof r.expires.toUTCString)throw new TypeError("option expires is invalid");u+="; Expires="+r.expires.toUTCString()}r.httpOnly&&(u+="; HttpOnly");r.secure&&(u+="; Secure");if(r.sameSite){var l="string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite;switch(l){case!0:u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"strict":u+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return u};var r=decodeURIComponent,o=encodeURIComponent,i=/; */,a=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function s(e,t){try{return t(e)}catch(t){return e}}},function(e,t,n){var r=n(46);function o(e){return r.createHash("sha1").update(e).digest("hex")}t.sign=function(e,t){if("string"!=typeof e)throw new TypeError("Cookie value must be provided as a string.");if("string"!=typeof t)throw new TypeError("Secret string must be provided.");return e+"."+r.createHmac("sha256",t).update(e).digest("base64").replace(/\=+$/,"")},t.unsign=function(e,n){if("string"!=typeof e)throw new TypeError("Signed cookie string must be provided.");if("string"!=typeof n)throw new TypeError("Secret string must be provided.");var r=e.slice(0,e.lastIndexOf("."));return o(t.sign(r,n))==o(e)&&r}},function(e,t){e.exports=require("jsonwebtoken@7.1.9")},function(e,t,n){"use strict";n.r(t),function(e){var r=n(52),o=n.n(r),i=n(53),a=n.n(i),s=n(45),u=n.n(s),c=n(54),l=n.n(c),d=n(3),p=n(1),f=n(55),h=n(78),g=n(80),v=n(72),m=n.n(v),b=n(56),y=n.n(b),w=n(81);t.default=function(t,n){y.a.setProvider(t);var r=n?new d.WebtaskStorageContext(n,{force:1}):new d.FileStorageContext(o.a.join(e,"./data.json"),{mergeWrites:!0}),i=new u.a;return i.use(a()(":method :url :status :response-time ms - :res[content-length]",{stream:m.a.stream})),i.use(l.a.json()),i.use(l.a.urlencoded({extended:!1})),i.use(p.routes.dashboardAdmins({secret:y()("EXTENSION_SECRET"),audience:"urn:sso-dashboard",rta:y()("AUTH0_RTA").replace("https://",""),domain:y()("AUTH0_DOMAIN"),baseUrl:y()("PUBLIC_URL"),clientName:"SSO Dashboard",urlPrefix:"/admins",sessionStorageKey:"sso-dashboard:apiToken",scopes:"read:clients delete:clients read:connections read:resource_servers create:resource_servers read:client_grants create:client_grants delete:client_grants"})),i.use("/api",Object(f.default)(r)),i.use("/app",u.a.static(o.a.join(e,"../dist"))),i.use("/meta",Object(h.default)()),i.use("/.extensions",Object(g.default)()),i.get("*",Object(w.default)()),i.use(p.middlewares.errorHandler(m.a.error)),i}}.call(this,"/")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("morgan@1.5.3")},function(e,t){e.exports=require("body-parser@1.12.4")},function(e,t,n){"use strict";n.r(t);var r=n(45),o=n(3),i=n(1),a=n(56),s=n.n(a),u=n(57),c=n(65),l=n(75),d=n(76);t.default=function(e){var t=Object(r.Router)();t.use(i.middlewares.authenticateUsers.optional({domain:s()("IS_APPLIANCE")?s()("AUTH0_DOMAIN"):s()("AUTH0_CUSTOM_DOMAIN"),audience:s()("API_AUDIENCE")||"urn:auth0-sso-dashboard",credentialsRequired:!1,onLoginSuccess:function(e,t,n){return e.user.scope&&e.user.scope.indexOf("manage:applications")>-1&&!e.user.sub.endsWith("@client")?n(new o.ForbiddenError('"manage:applications" scope is not allowed for endusers.')):n()}})),t.use(i.middlewares.authenticateAdmins.optional({credentialsRequired:!1,secret:s()("EXTENSION_SECRET"),audience:"urn:sso-dashboard",baseUrl:s()("PUBLIC_URL"),onLoginSuccess:function(e,t,n){e.user.scope=["read:applications","manage:applications","manage:authorization"],n()}}));var n=i.middlewares.managementApiClient({domain:s()("AUTH0_DOMAIN")});return t.use("/applications",Object(c.default)(n,e)),t.use("/groups",Object(l.default)(e)),t.use("/authorization",Object(d.default)(e)),t.use("/connections",Object(u.default)(n)),t.get("/status",function(e,t){t.json({isAdmin:e.user.scope&&e.user.scope.indexOf("manage:applications")>-1})}),t}},function(e,t){var n={},r=null,o=function(e){return"true"===e||"false"===e?"true"===e:e},i=function e(t){if(n&&n[t])return o(n[t]);if(!r)throw new Error("A configuration provider has not been set");return"PUBLIC_URL"===t?r("REVERSE_PROXY_URL")||n.PUBLIC_WT_URL:"AUTH0_CUSTOM_DOMAIN"===t?r("AUTH0_CUSTOM_DOMAIN")||r("AUTH0_DOMAIN"):"IS_APPLIANCE"===t?e("AUTH0_RTA")&&"auth0.auth0.com"!==e("AUTH0_RTA").replace("https://",""):o(r(t))};i.setProvider=function(e){r=e},i.setValue=function(e,t){n[e]=t},e.exports=i},function(e,t,n){"use strict";n.r(t);var r=n(58),o=n.n(r),i=n(45),a=n(59),s=n(61);t.default=function(e){var t=Object(i.Router)();return t.get("/",e,Object(a.requireScope)("manage:applications"),function(e,t,n){Object(s.default)(e.auth0,"connections",{fields:"name"}).then(function(e){return o.a.chain(e).sortBy(function(e){return e.name.toLowerCase()}).value()}).then(function(e){return t.json(e)}).catch(n)}),t}},function(e,t){e.exports=require("lodash@3.10.1")},function(e,t,n){"use strict";n.r(t);var r=n(60);n.d(t,"requireScope",function(){return r.default})},function(e,t,n){"use strict";n.r(t);var r=n(3);t.default=function(e){return function(t,n,o){return!t.user||!t.user.scope||t.user.scope.indexOf(e)<0?o(new r.ForbiddenError(`Cannot perform action. Missing scope ${e}`)):o()}}},function(e,t,n){"use strict";n.r(t);var r=n(62),o=n.n(r),i=n(64),a=n.n(i),s=n(3);t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;if(null===e||void 0===e)throw new s.ArgumentError("Must provide a auth0 client object.");if(!t&&!e[t])throw new s.ArgumentError("Must provide a valid entity for auth0 client.");var u=e[t].getAll,c=o()({},n,{per_page:r}),l=[],d=0,p=0,f=function(e){return u(o()({},c,{page:e})).then(function(e){return e.forEach(function(e){return l.push(e)}),null})};return u(o()({},c,{include_totals:!0,page:0})).then(function(e){return d=e.total||0,p=Math.ceil(d/r),(e[t]||e||[]).forEach(function(e){return l.push(e)}),null}).then(function(){if(0===d||l.length>=d)return l;for(var e=[],t=1;t<=p;t++)e.push(t);return a.a.map(e,f,{concurrency:i})}).then(function(){return l})}},function(e,t,n){var r=n(63);e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){r(e,t,n[t])})}return e}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=require("bluebird@3.4.6")},function(e,t,n){"use strict";n.r(t);var r=n(62),o=n.n(r),i=n(58),a=n.n(i),s=n(66),u=n.n(s),c=n(45),l=n(56),d=n.n(l),p=n(59),f=n(68),h=n(70),g=n(74),v=n(61);t.default=function(e,t){var n=Object(c.Router)();return n.get("/clients",e,Object(p.requireScope)("manage:applications"),function(e,t,n){Object(v.default)(e.auth0,"clients",{is_global:!1,fields:"client_id,name,callbacks,app_type"}).then(function(e){return a.a.chain(e).sortBy(function(e){return e.name.toLowerCase()}).value()}).then(function(e){return t.json(e)}).catch(n)}),n.get("/",Object(p.requireScope)("read:applications"),function(e,n,r){var i;t.read().then(function(e){return i=e.applications||{},null}).then(function(){return t.read()}).then(function(t){return d()("ALLOW_AUTHZ")&&t.authorizationEnabled?Object(h.getGroupsForUser)(e.user.sub):null}).then(function(e){var t={};return Object.keys(i).map(function(n){var r=i[n];return r.enabled&&r.loginUrl&&Object(g.hasGroup)(e,r.groups)&&(t[n]=r),r}),t}).then(function(e){return n.json(a.a.map(e,function(e,t){return o()({},e,{id:t})}))}).catch(r)}),n.get("/all",Object(p.requireScope)("manage:applications"),function(e,n,r){t.read().then(function(e){return n.json(a.a.map(e.applications||{},function(e,t){return o()({},e,{id:t})}))}).catch(r)}),n.get("/:id",Object(p.requireScope)("manage:applications"),function(e,n,r){t.read().then(function(t){return n.json({application:t.applications[e.params.id]})}).catch(r)}),n.put("/:id",Object(p.requireScope)("manage:applications"),function(e,n,r){Object(f.saveApplication)(e.params.id,e.body,t).then(function(){return n.status(204).send()}).catch(r)}),n.patch("/:id/:direction(-[0-9]*|[0-9]*)",Object(p.requireScope)("manage:applications"),function(e,n,r){Object(f.moveApplication)(e.params.id,parseInt(e.params.direction,10),t).then(function(){return n.status(204).send()}).catch(r)}),n.post("/",Object(p.requireScope)("manage:applications"),function(e,n,r){var o=u.a.v4();Object(f.saveApplication)(o,e.body,t).then(function(){return n.status(201).send({id:o})}).catch(r)}),n.delete("/:id",Object(p.requireScope)("manage:applications"),function(e,n,r){Object(f.deleteApplication)(e.params.id,t).then(function(){return n.status(204).send()}).catch(r)}),n}},function(e,t,n){for(var r=n(67),o=[],i={},a=0;a<256;a++)o[a]=(a+256).toString(16).substr(1),i[o[a]]=a;function s(e,t){var n=t||0,r=o;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}var u=r(),c=[1|u[0],u[1],u[2],u[3],u[4],u[5]],l=16383&(u[6]<<8|u[7]),d=0,p=0;function f(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;a++)t[o+a]=i[a];return t||s(i)}var h=f;h.v1=function(e,t,n){var r=t&&n||0,o=t||[],i=void 0!==(e=e||{}).clockseq?e.clockseq:l,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:p+1,f=a-d+(u-p)/1e4;if(f<0&&void 0===e.clockseq&&(i=i+1&16383),(f<0||a>d)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=a,p=u,l=i;var h=(1e4*(268435455&(a+=122192928e5))+u)%4294967296;o[r++]=h>>>24&255,o[r++]=h>>>16&255,o[r++]=h>>>8&255,o[r++]=255&h;var g=a/4294967296*1e4&268435455;o[r++]=g>>>8&255,o[r++]=255&g,o[r++]=g>>>24&15|16,o[r++]=g>>>16&255,o[r++]=i>>>8|128,o[r++]=255&i;for(var v=e.node||c,m=0;m<6;m++)o[r+m]=v[m];return t||s(o)},h.v4=f,h.parse=function(e,t,n){var r=t&&n||0,o=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){o<16&&(t[r+o++]=i[e])});o<16;)t[r+o++]=0;return t},h.unparse=s,e.exports=h},function(e,t,n){var r=n(46).randomBytes;e.exports=function(){return r(16)}},function(e,t,n){"use strict";n.r(t),n.d(t,"saveApplication",function(){return s}),n.d(t,"moveApplication",function(){return u}),n.d(t,"deleteApplication",function(){return c});var r=n(64),o=n.n(r),i=n(3),a=n(69),s=function(e,t,n){return new o.a(function(r,o){var i={name:t.name,client:t.client,enabled:t.enabled,type:t.type,logo:t.logo,connection:t.connection,groups:Array.isArray(t.groups)?t.groups:[t.groups],callback:t.callback,customURL:t.customURL,customURLEnabled:t.customURLEnabled};"oidc"===t.type&&(i.response_type=t.response_type||"code",i.scope=t.scope||"openid"),i.loginUrl=Object(a.default)(i),n.read().then(function(t){return(t=t||{}).applications=t.applications||{},t.applications[e]=i,n.write(t).then(r).catch(o)}).catch(o)})},u=function(e,t,n){return n.read().then(function(r){r.applications=r.applications||{};var a=Object.keys(r.applications),s=a.indexOf(e),u=s+t;if(s<0)return o.a.reject(new i.NotFoundError(`Application "${e}" not found.`));if(u>=0&&u<a.length){var c={};return a.splice(u,0,a.splice(s,1)[0]),a.forEach(function(e){c[e]=r.applications[e]}),r.applications=c,n.write(r)}return o.a.reject(new i.ArgumentError(`Application "${e}" cannot be moved to "${u}" position.`))})},c=function(e,t){return new o.a(function(n,r){t.read().then(function(o){return o.applications[e]=null,delete o.applications[e],t.write(o).then(n).catch(r)}).catch(r)})}},function(e,t,n){"use strict";n.r(t);var r=n(56),o=n.n(r);t.default=function(e){var t=e.type,n=e.callback||"",r=o()("AUTH0_CUSTOM_DOMAIN"),i=e.client,a=e.response_type||"code",s=e.scope||"openid",u="";switch(t){case"saml":u=`https://${r}/samlp/${i}`;break;case"wsfed":u=`https://${r}/wsfed/${i}?wreply=${n}`;break;default:case"oidc":u=`https://${r}/authorize?response_type=${a}&scope=${s}&client_id=${i}&redirect_uri=${encodeURIComponent(n)}`}e.connection&&(u+=`${u.indexOf("?")<0?"?":"&"}${"wsfed"===t?"whr":"connection"}=${e.connection}`);return u}},function(e,t,n){"use strict";n.r(t),n.d(t,"getGroups",function(){return b}),n.d(t,"getGroupsForUser",function(){return y}),n.d(t,"getResourceServer",function(){return k}),n.d(t,"createResourceServer",function(){return S}),n.d(t,"deleteResourceServer",function(){return x}),n.d(t,"addGrant",function(){return E}),n.d(t,"removeGrant",function(){return T});var r=n(58),o=n.n(r),i=n(64),a=n.n(i),s=n(71),u=n.n(s),c=n(28),l=n.n(c),d=n(3),p=n(56),f=n.n(p),h=n(72),g=n.n(h),v=function(){if(f()("AUTHZ_API_DEV_URL"))return f()("AUTHZ_API_DEV_URL");var e=f()("PUBLIC_URL");"/"===e[e.length-1]&&(e[e.length-1]="");var t=e.split("/");return t[t.length-1]="adf6e2f2b84784b57522e3b19dfc9201/api",t.join("/")},m=a.a.promisify(l()({load:function(e){new a.a(function(e,t){var n={client_id:f()("AUTH0_CLIENT_ID"),client_secret:f()("AUTH0_CLIENT_SECRET"),audience:"urn:auth0-authz-api",grant_type:"client_credentials"};u()("POST",`https://${f()("AUTH0_DOMAIN")}/oauth/token`).send(n).set("Content-Type","application/json").end(function(n,r){return!n&&r.body&&r.body.access_token?e(r.body.access_token):(g.a.error(r.body),t(n))})}).then(function(t){return e(null,t)}).catch(function(t){return e(t)})},hash:function(){return"auth0-authz-apiToken"},max:100,maxAge:36e5})),b=function(){return new a.a(function(e,t){return m().then(function(n){return n?u()("GET",`${v()}/groups`).set("Content-Type","application/json").set("Authorization",`Bearer ${n}`).end(function(n,r){return n?(g.a.error(r.body),t(n)):e(r.body.groups||[])}):e(null)}).catch(t)})},y=function(e){return new a.a(function(t,n){return m().then(function(r){return r?e?u()("GET",`${v()}/users/${e}/groups/calculate`).set("Content-Type","application/json").set("Authorization",`Bearer ${r}`).end(function(e,r){if(e)return g.a.error(r.body),n(e);var i=o.a.map(r.body||[],function(e){return e._id});return t(i)}):n(new d.ValidationError("User ID is required.")):t(null)}).catch(n)})},w=function(e,t,n,r){return new a.a(function(o,i){return function(e){return e.user&&e.user.access_token&&e.user.access_token.length?a.a.resolve(e.user.access_token):d.managementApi.getAccessTokenCached(f()("AUTH0_DOMAIN"),f()("AUTH0_CLIENT_ID"),f()("AUTH0_CLIENT_SECRET"))}(e).then(function(e){u()(n,`https://${f()("AUTH0_DOMAIN")}/api/v2/${t}`).send(r||{}).set("Content-Type","application/json").set("Authorization",`Bearer ${e}`).end(function(e,t){return e?(g.a.error(t.body),i(e)):o(t.body)})})})},k=function(e,t){return w(e,"resource-servers","GET").then(function(e){var n=e.filter(function(e){return e.identifier===t});return n.length&&n[0]})},S=function(e){var t={name:f()("API_NAME")||"SSO Dashboard API",identifier:f()("API_AUDIENCE")||"urn:auth0-sso-dashboard",signing_alg:"RS256",scopes:[{value:"read:applications",description:"Get applications"},{value:"manage:applications",description:"Manage applications"}],token_lifetime:86400};return w(e,"resource-servers","POST",t)},x=function(e){return k(e,"urn:auth0-sso-dashboard").then(function(t){return t.id?w(e,`resource-servers/${t.id}`,"DELETE"):a.a.resolve()})},E=function(e){return w(e,"client-grants","POST",{client_id:f()("AUTH0_CLIENT_ID"),audience:"urn:auth0-authz-api",scope:["read:users","read:groups"]})},T=function(e){return function(e){return w(e,"client-grants","GET").then(function(e){return e.filter(function(e){return e.client_id===f()("AUTH0_CLIENT_ID")&&"urn:auth0-authz-api"===e.audience})}).then(function(e){return e[0]&&e[0].id})}(e).then(function(t){return t?w(e,`client-grants/${t}`,"DELETE"):a.a.resolve()})}},function(e,t){e.exports=require("superagent@1.2.0")},function(e,t,n){var r=n(73);r.emitErrs=!0;var o=new r.Logger({transports:[new r.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});e.exports=o,e.exports.stream={write:function(e){o.info(e.replace(/\n$/,""))}}},function(e,t){e.exports=require("winston@1.0.0")},function(e,t,n){"use strict";n.r(t),n.d(t,"hasGroup",function(){return i});var r=n(58),o=n.n(r),i=function(e,t){if(!e||!t||!t.length)return!0;var n=o.a.intersection(e,t);return n&&n.length>=1}},function(e,t,n){"use strict";n.r(t);var r=n(45),o=n(56),i=n.n(o),a=n(70),s=n(59);t.default=function(e){var t=Object(r.Router)();return t.get("/",Object(s.requireScope)("manage:applications"),function(t,n,r){return i()("ALLOW_AUTHZ")?e.read().then(function(e){return e.authorizationEnabled?Object(a.getGroups)(t.params.appId).then(function(e){return n.json(e)}):n.json([])}).catch(r):n.json([])}),t}},function(e,t,n){"use strict";n.r(t);var r=n(45),o=n(56),i=n.n(o),a=n(77),s=n(59);t.default=function(e){var t=Object(r.Router)();return t.get("/",Object(s.requireScope)("manage:authorization"),function(t,n,r){return i()("ALLOW_AUTHZ")?a.getStatus(t,e).then(function(e){return n.json(e)}).catch(r):n.json({authorizationApiAvailable:!1})}),t.post("/",Object(s.requireScope)("manage:authorization"),function(t,n,r){return i()("ALLOW_AUTHZ")?a.enable(t,e).then(function(){return n.json({enabled:!0})}).catch(r):r()}),t.delete("/",Object(s.requireScope)("manage:authorization"),function(t,n,r){return i()("ALLOW_AUTHZ")?a.disable(t,e).then(function(){return n.json({enabled:!1})}).catch(r):r()}),t}},function(e,t,n){"use strict";n.r(t),n.d(t,"getStatus",function(){return s}),n.d(t,"enable",function(){return u}),n.d(t,"disable",function(){return c});var r=n(64),o=n.n(r),i=n(3),a=n(70),s=function(e,t){return t.read().then(function(t){var n={authorizationEnabled:t.authorizationEnabled};return Object(a.getResourceServer)(e,"urn:auth0-authz-api").then(function(e){return n.authorizationApiAvailable=!!e,n})})},u=function(e,t){return t.read().then(function(n){return n.authorizationEnabled?o.a.resolve():Object(a.getResourceServer)(e,"urn:auth0-authz-api").then(function(r){if(!r){var s=new i.ValidationError("Authorization API not found.");return s.status=400,o.a.reject(s)}return Object(a.addGrant)(e).then(function(){return n.authorizationEnabled=!0,t.write(n)})})})},c=function(e,t){return t.read().then(function(n){return n.authorizationEnabled?Object(a.removeGrant)(e).then(function(){return n.authorizationEnabled=!1,t.write(n)}):o.a.resolve()})}},function(e,t,n){"use strict";n.r(t);var r=n(45),o=n.n(r),i=n(79);t.default=function(){var e=o.a.Router();return e.get("/",function(e,t){t.status(200).send(i)}),e}},function(e){e.exports={title:"Custom SSO Dashboard",name:"sso-dashboard",version:"2.4.0",preVersion:"2.2.1",author:"Dan Baker",useHashName:!1,description:"This extension provides your users with a dashboard for all of their applications.",type:"application",category:"end_user",logoUrl:"https://cdn.auth0.com/extensions/auth0-sso-dashboard/assets/logo.svg",initialUrlPath:"/admins/login",codeUrl:"https://raw.githubusercontent.com/danielbaker/auth0-sso-dashboard-extension/master/build/bundle.js",repository:"https://github.com/danielbaker/auth0-sso-dashboard-extension",keywords:["extension"],secrets:{EXTENSION_CLIENT_ID:{description:"Client ID of the application you created in the Auth0 Management Dashboard",required:!0},TITLE:{description:"Custom title for the dashboard",example:"Fabrikam SSO Dashboard",required:!1},CUSTOM_CSS:{description:"A CSS file containing custom styles for the extension",example:"https://cdn.fabrikam.com/static/extensions/theme/fabrikam.css",required:!1},AUTH0_CUSTOM_DOMAIN:{description:"Custom domain",example:"example.com",required:!1},REVERSE_PROXY_URL:{description:"URL of the reverse proxy that serves the extension. Leave blank if no reverse proxy in use",example:"reverse-proxy.com",required:!1},ALLOW_AUTHZ:{description:"Allow enabling of Authorization Extension integration (Deprecated)",type:"select",allowMultiple:!1,default:"false",options:[{value:"false",text:"No"},{value:"true",text:"Yes"}]}}}},function(e,t,n){"use strict";n.r(t);var r=n(45),o=n(1),i=n(56),a=n.n(i),s=n(72),u=n.n(s),c=n(70);t.default=function(){var e=Object(r.Router)(),t=o.middlewares.validateHookToken(a()("AUTH0_DOMAIN"),a()("WT_URL"),a()("EXTENSION_SECRET"));return e.use("/on-install",t("/.extensions/on-install")),e.use("/on-update",t("/.extensions/on-update")),e.use("/on-uninstall",t("/.extensions/on-uninstall")),e.use(o.middlewares.managementApiClient({domain:a()("AUTH0_DOMAIN"),clientId:a()("AUTH0_CLIENT_ID"),clientSecret:a()("AUTH0_CLIENT_SECRET")})),e.post("/on-install",function(e,t){Object(c.getResourceServer)(e,"urn:auth0-sso-dashboard").then(function(t){return t?Promise.resolve():Object(c.createResourceServer)(e)}).then(function(){u.a.debug("Resource server for the SSO Dashboard extension created.")}).then(function(){t.sendStatus(204)}).catch(function(e){u.a.debug("Error deploying resources for the SSO Dashboard extension."),u.a.error(e),t.sendStatus(400)})}),e.put("/on-update",function(e,t){Object(c.getResourceServer)(e,"urn:auth0-sso-dashboard").then(function(t){return t?Promise.resolve():Object(c.createResourceServer)(e)}).then(function(){u.a.debug("Resource server for the SSO Dashboard extension created.")}).then(function(){t.sendStatus(204)}).catch(function(e){u.a.debug("Error deploying resources for the SSO Dashboard extension."),u.a.error(e),t.sendStatus(400)})}),e.delete("/on-uninstall",function(e,t){var n=a()("AUTH0_CLIENT_ID");Object(c.deleteResourceServer)(e).then(function(){return e.auth0.clients.delete({client_id:n})}).then(function(){u.a.debug(`Deleted client ${n}`),t.sendStatus(204)}).catch(function(e){u.a.debug(`Error deleting client: ${a()("AUTH0_CLIENT_ID")}`),u.a.error(e),t.sendStatus(204)})}),e}},function(e,t,n){"use strict";n.r(t),function(e){n(62),n(82);var r=n(83),o=n.n(r),i=(n(52),n(1)),a=n(56),s=n.n(a);t.default=function(){var e='\n  <!DOCTYPE html>\n  <html lang="en">\n  <head>\n    <title><%= config.TITLE %></title>\n    <meta charset="UTF-8" />\n    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <link rel="shortcut icon" href="https://cdn.auth0.com/styleguide/4.6.13/lib/logos/img/favicon.png">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styles/zocial.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/manage/v0.3.1672/css/index.min.css" />\n    <link rel="stylesheet" type="text/css" href="https://cdn.auth0.com/styleguide/4.6.13/index.min.css" />\n    <% if (assets.style) { %><link rel="stylesheet" type="text/css" href="/app/<%= assets.style %>" /><% } %>\n    <% if (assets.version) { %><link rel="stylesheet" type="text/css" href="//cdn.auth0.com/extensions/auth0-sso-dashboard/assets/auth0-sso-dashboard.ui.<%= assets.version %>.css" /><% } %>\n    <% if (assets.customCss) { %><link rel="stylesheet" type="text/css" href="<%= assets.customCss %>" /><% } %>\n  </head>\n  <body>\n    <div id="app"></div>\n    <script type="text/javascript" src="//cdn.auth0.com/js/auth0/8.6/auth0.min.js"><\/script>\n    <script type="text/javascript" src="//cdn.auth0.com/manage/v0.3.1672/js/bundle.js"><\/script>\n    <script type="text/javascript">window.config = <%- JSON.stringify(config) %>;<\/script>\n    <% if (assets.vendors) { %><script type="text/javascript" src="/app/<%= assets.vendors %>"><\/script><% } %>\n    <% if (assets.app) { %><script type="text/javascript" src="/app/<%= assets.app %>"><\/script><% } %>\n    <% if (assets.bundle) { %><script type="text/javascript" src="<%= assets.bundle %>"><\/script><% } %>\n    <% if (assets.version) { %>\n    <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-sso-dashboard/assets/auth0-sso-dashboard.ui.vendors.<%= assets.version %>.js"><\/script>\n    <script type="text/javascript" src="//cdn.auth0.com/extensions/auth0-sso-dashboard/assets/auth0-sso-dashboard.ui.<%= assets.version %>.js"><\/script>\n    <% } %>\n  </body>\n  </html>\n  ';return function(t,n,r){if(0===t.url.indexOf("/api"))return r();var a={AUTH0_CUSTOM_DOMAIN:s()("AUTH0_CUSTOM_DOMAIN"),AUTH0_DOMAIN:s()("AUTH0_DOMAIN"),IS_APPLIANCE:s()("IS_APPLIANCE"),AUTH0_CLIENT_ID:s()("EXTENSION_CLIENT_ID"),AUTH0_MANAGE_URL:s()("AUTH0_MANAGE_URL")||"https://manage.auth0.com",ALLOW_AUTHZ:s()("ALLOW_AUTHZ"),BASE_URL:s()("PUBLIC_URL"),BASE_PATH:i.urlHelpers.getBasePath(t),TITLE:s()("TITLE")};return n.send(o.a.render(e,{config:a,assets:{customCss:s()("CUSTOM_CSS"),version:"2.4.0"}}))}}}.call(this,"/")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("ejs@2.3.1")}]);